# 更新日志

## [2.0.0] - 2026-01-XX

### 🎉 重大更新

#### 🔐 安全增强
- **hCaptcha 验证码集成**：管理员登录支持 hCaptcha 人机验证
  - 后台可配置启用/禁用
  - 支持自定义 Site Key 和 Secret Key
  - 使用官方 `@hcaptcha/react-hcaptcha` 组件
  - 独立配置面板，位于"账户设置"和"自定义配置"之间

#### 🎬 B站切片链接功能
- **切片链接显示**：歌曲列表支持显示 B站切片链接
  - 有链接的歌曲显示播放图标
  - 点击图标直接跳转到 B站切片页面
  - 自动提取并显示 BV 号
- **后台管理**：管理员可在后台查看和编辑切片链接
- **数据导入**：支持从 JSON 和 Excel 导入切片链接
- **数据库字段**：新增 `bilibili_clip_url` 字段

#### 📋 复制功能增强
- **复制模式配置**：支持两种复制模式
  - **点歌模式**：复制格式为 "点歌 歌名"（适合直播间）
  - **正常模式**：仅复制歌名
- **后台配置**：在站点配置页面可切换复制模式
- **提示优化**：复制提示框显示在屏幕顶部，更醒目

#### 🏷️ 标签云筛选系统
- **多维度筛选**：支持按首字母、语言、分类、特殊标签筛选
- **可视化标签云**：使用 Chip 组件展示，点击切换筛选
- **后端支持**：新增 `/api/playlist/tag-cloud` 接口
- **实时筛选**：选择标签后立即更新歌曲列表

#### 🎨 主题系统重构
- **轻动漫风格预设**：新增 6 套清新配色预设
  - 樱花粉
  - 天空蓝
  - 薄荷绿
  - 薰衣草紫
  - 蜜桃橙
  - 海洋青
- **纯色设计**：移除所有渐变效果，采用纯色设计
- **系统主题跟随**：优先使用系统日夜间模式设置
  - 初始化时检测系统偏好
  - 用户仍可手动切换主题
  - 移除时间自动切换功能

#### 📱 布局优化
- **PC 端优化**：
  - 歌曲列表居中显示，左右等距留白
  - 列表高度自适应，与左侧标签云对齐
  - 歌曲名称和标签横向展示，更紧凑
  - 标签可点击进行筛选
- **移动端美化**：
  - 更透明的卡片设计，增强通透感
  - 优化搜索和筛选按钮样式
  - 改进筛选抽屉交互
  - 增强分页组件视觉效果
  - 更大的字体和更好的间距

#### 🖼️ 背景效果优化
- **去除白色遮罩**：移除日间模式的白色遮罩层
- **轻微模糊**：仅保留背景模糊效果，增强美观性
- **移动端优化**：背景只裁剪中间部分，不跟随列表滚动
- **固定背景**：背景图片固定，不随内容滚动

#### 🔄 用户体验改进
- **无感加载**：登录页面共享全局背景，无刷新感
- **复制提示位置**：提示框显示在顶部导航栏下方
- **高度自适应**：PC 端列表高度跟随内容自适应

### 🐛 Bug 修复
- ✅ 修复 `bilibili_clip_url` 字段未正确解析和显示的问题
- ✅ 修复分类标签云筛选无效的问题（后端支持）
- ✅ 修复 PC 端歌曲列表高度固定不自适应的问题
- ✅ 修复保存 hCaptcha 配置时 `NOT NULL constraint` 错误
- ✅ 修复 hCaptcha 验证码组件加载失败的问题
- ✅ 修复登录页面背景刷新导致的视觉闪烁

### 🎨 UI/UX 改进
- 移除所有渐变效果，采用纯色设计
- 优化日间模式透明度，增强背景可见度
- 改进标签云视觉效果，使用 Chip 组件
- 优化移动端卡片透明度和层次感
- 增强按钮和交互元素的视觉反馈
- 统一设计语言，提升整体美观度

### 🔧 技术改进
- **数据库扩展**：
  - 新增 `copy_mode` 字段（site_config）
  - 新增 `bilibili_clip_url` 字段（playlist）
  - 新增 `hcaptcha_enabled`、`hcaptcha_site_key`、`hcaptcha_secret_key` 字段（site_config）
- **后端 API**：
  - 新增 `GET /api/playlist/tag-cloud` 接口
  - 新增 `GET /api/site/hcaptcha-config` 接口
  - 登录接口支持 `hcaptchaToken` 参数
  - 支持按 `category` 筛选歌曲
- **前端依赖**：
  - 新增 `@hcaptcha/react-hcaptcha` 包
- **工具脚本**：
  - `xlsx2json.js` 支持 `bilibiliClipUrl` 字段导入
- **代码优化**：
  - 重构主题初始化逻辑
  - 优化标签筛选性能
  - 改进错误处理机制

### 📝 更新说明
v2.0 是一个重大版本更新，引入了多项新功能和体验优化。主要亮点包括 hCaptcha 安全验证、B站切片链接集成、标签云筛选系统，以及全面的 UI/UX 改进。建议所有用户升级到此版本。

---

## [1.2.0] - 2026-01-11

### 🎉 新功能

#### 🖼️ 背景和头像系统
- **全局背景图片**：支持自定义背景图片，全局展示
- **移动端自适应**：背景图片自动裁剪适配移动端
- **头像展示**：头像显示在歌单标题正上方，圆形蒙版
- **毛玻璃效果**：所有内容层使用液态玻璃遮罩，多层模糊处理
- **自动URL填充**：上传图片后自动填充完整URL（当前域名+路径）

#### 📝 SEO 和标题优化
- **副标题设置**：支持设置站点副标题
- **动态网页标题**：格式为"站点名称 - 副标题"
- **SEO关键词**：支持设置SEO关键词
- **SEO描述**：支持设置SEO描述，自动更新meta标签

#### 💻 自定义代码功能
- **自定义CSS**：支持注入自定义CSS代码
- **自定义JavaScript**：支持注入自定义JavaScript代码
- **实时生效**：保存后刷新页面即可看到效果
- **独立配置面板**：在管理后台新增"自定义配置"标签页

### 🐛 Bug 修复
- ✅ 修复上传图片后URL未自动填充的问题
- ✅ 修复背景图片和头像未正确展示的问题
- ✅ 修复siteName未更新网页title的问题
- ✅ 优化毛玻璃效果的层级关系

### 🎨 UI/UX 改进
- 背景图片全局展示，移动端自适应裁剪
- 头像圆形蒙版，带渐变边框和阴影
- 所有内容层使用毛玻璃遮罩，提升视觉层次
- AppBar、Footer等组件增强毛玻璃效果
- 优化多层玻璃遮罩之间的模糊关系

### 🔧 技术改进
- 数据库结构扩展：新增site_subtitle、seo_keywords、seo_description、custom_css、custom_js字段
- 自动数据库迁移：支持旧数据库自动添加新字段
- 动态meta标签更新：根据配置自动更新SEO信息
- 自定义代码注入：安全的CSS和JS代码注入机制

---

## [1.1.0] - 2026-01-10

### 🎉 新功能

#### 🎨 主题自定义系统
- **自定义主题配色**：用户可以自由选择主色调和辅色调
- **6个预设主题**：快速切换不同配色方案
  - 默认粉紫
  - 蓝紫渐变
  - 绿松石
  - 橙粉红
  - 青蓝色
  - 紫红渐变
- **实时预览**：修改后即刻看到效果
- **本地存储**：配色保存在浏览器localStorage，无需登录
- **主题模式记忆**：深色/浅色模式自动保存

#### 📱 响应式布局优化
- **PC端（≥960px）**：
  - 左侧固定筛选栏（sticky定位）
  - 右侧内容区域更宽敞
  - 每行最多显示4列歌曲卡片
  - 搜索框集成在筛选栏内
- **移动端（<960px）**：
  - 底部抽屉式筛选器
  - 顶部搜索栏 + 筛选按钮
  - 每行最多2列歌曲卡片
  - 更符合移动端操作习惯

### 🐛 Bug 修复
- ✅ 修复首次访问不跳转到安装页面的问题
- ✅ 修复日间模式下AppBar图标可读性问题
- ✅ 改进API错误处理逻辑

### 🎨 UI/UX 改进
- 图标颜色优化：浅色模式下使用主题色，提升可读性
- AppBar背景增强：更好的液态玻璃效果
- 筛选器组件化：代码更清晰，维护更方便
- 歌曲卡片组件化：提升代码复用性

### 🔧 技术改进
- 使用localStorage持久化用户偏好设置
- 添加useMediaQuery响应式断点判断
- 新增ThemeCustomizer组件
- 新增SongCard组件
- 代码结构优化

### 📝 更新说明
此版本主要优化用户体验，新增主题自定义功能，并针对不同设备提供了更合适的布局方案。

---

## [1.0.0] - 2026-01-09

### 新增功能

- 🎨 全新的二次元风格界面设计
- 🌓 支持深色/浅色主题切换
- 🎵 完整的歌单管理系统
- 🔍 强大的筛选和搜索功能
- 📋 一键复制歌曲名
- 🎛️ 管理后台系统
- 📦 JSON 格式导入导出
- 🔧 XLSX 转 JSON 工具
- 🐳 Docker 容器化部署
- 🚀 GitHub Actions CI/CD
- 📄 完整的文档和示例

### 技术栈

- 后端：Node.js + Express + SQLite
- 前端：React 18 + MUI v7 + Vite
- 部署：Docker + Docker Compose
- CI/CD：GitHub Actions

### 特色功能

- 液态玻璃效果（Glassmorphism）
- 渐变色主题系统
- 防抖搜索
- 分页浏览
- 文件上传
- 数据备份恢复

---

## 即将到来

- [x] ~~多主题预设~~ (v1.1.0 已完成)
- [x] ~~响应式布局优化~~ (v1.1.0 已完成)
- [ ] 歌单标签系统
- [ ] 批量操作功能
- [ ] 歌曲评分系统
- [ ] 播放历史记录
- [ ] 用户收藏夹
- [ ] 数据统计图表
- [ ] 导入导出增强（支持Excel）

